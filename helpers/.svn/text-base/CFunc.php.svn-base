<?php
namespace fec\helpers;
use Yii; 
# 一些常用的函数
class CFunc
{
	
	# object 转换成  数组。
	public static function object_to_array($obj)
	{
		//$_arr = is_object($obj) ? get_object_vars($obj) : $obj;
		if(is_object($obj) || is_array($obj)){
			if(is_object($obj)){
				$_arr = get_object_vars($obj);
			}else{
				$_arr = $obj;
			}
			foreach ($_arr as $key => $val)
			{
				$val = (is_array($val) || is_object($val)) ? self::object_to_array($val) : $val;
				$arr[$key] = $val;
			}
			return $arr;
		}else{
			return $obj;
		}
		
	}
	
	#是否是时间格式
	public static function is_time($time)
	{
		$time = trim($time);
		$pattern1 = '/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/s';
		$r1 =  preg_match($pattern1, $time);
		
		$pattern2 = '/^\d{4}-\d{2}-\d{2}$/s';
		$r2 =  preg_match($pattern2, $time);
		return ($r1 || $r2 );
	}
	
	/*  譬如数组
		$arr = [
			['name' = 'x1','age'=33],
			['name' = 'y1','age'=11],
			['name' = 'a1','age'=66],
			['name' = 't1','age'=44],
		];
		$result = CFunc::array_sort($arr,'name','asc');
	*/
	# 二维数组进行排序
	# $array为要排序的数组
	# $keys为要用来排序的键名,二维数组的key
	# $type默认为升序排序 
	public static function array_sort($array,$keys,$type='asc'){  
		 
		$keysvalue = $new_array = array();  
		foreach ($array as $k=>$v){  
			$keysvalue[$k] = $v[$keys];  
		}  
		if($type == 'asc'){  
			asort($keysvalue);  
		}else{  
			arsort($keysvalue);  
		}  
		reset($keysvalue);  
		foreach ($keysvalue as $k=>$v){  
			$new_array[$k] = $array[$k];  
		}  
		return $new_array;  
	}
	
	
	public static function  get_real_ip(){
		$ip=false;
		if(!empty($_SERVER["HTTP_CLIENT_IP"])){
			$ip = $_SERVER["HTTP_CLIENT_IP"];
		}
		if (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) {
			$ips = explode (", ", $_SERVER['HTTP_X_FORWARDED_FOR']);
			if ($ip) { 
				array_unshift($ips, $ip); $ip = FALSE; 
			}
			for ($i = 0; $i < count($ips); $i++) {
				if (!eregi ("^(10|172\.16|192\.168)\.", $ips[$i])) {
					$ip = $ips[$i];
					break;
				}
			}
			}
		return ($ip ? $ip : $_SERVER['REMOTE_ADDR']);
	}
	
}